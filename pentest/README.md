# pentest

This is a sample amplify-flutter application for our pre-launch pen-testing. It includes two environments for testing various code paths:

- hostedUI: Used for testing Cognito's OAuth capability
- deviceTracking: Used for testing device tracking

Both of these can be used to test most other standard Auth APIs.

This project includes both a front end application, as well as basic scaffolding for running integration tests.

## Installing Dart dependencies

From the root of the directory, run `flutter pub get`.

## Installing Linux dependencies

All platform specific dependencies are downloaded for you, with the exception of 2 linux packages. These can be installed with:

```terminal
sudo apt-get update -y
sudo apt-get install -y libsecret-1-dev
sudo apt-get install -y libglib2.0-dev
```

## Enabling MacOS Support

If you try to run on MacoOS without following the steps below, it is likely you will receive a message to this affect:

To enable MacOS, complete the following:

1. Enable network calls
    * In Xcode, enable the Client networking entitlement and add the Keychain Sharing entitlement as shown

2. Add your app to a Keychain Access Group. 

Amplify Auth stores auth credentials in Keychain on MacOS. The keychain option kSecUseDataProtectionKeychain (https://developer.apple.com/documentation/security/ksecusedataprotectionkeychain?language=objc) is enabled by default, which makes it so that only your app has access to these credentials. This requires that your app be in at least one Keychain Access Group. Below are the steps to add your app to the default group, using your appâ€™s bundle identifier.

    * Open the MacOS project in Xcode (from VS Code, right click on the /macos dir and select "Open in Xcode")
    * Select "Runner" on the left side panel, then select the "Signing & Capabilities" tab, and tap the "+" icon.
    * Search for "Keychain Sharing" and add the "Keychain Sharing" capability.
    * Scroll down to Keychain Sharing and click the "+" icon. By default, your bundle ID will be used.


3. If you have not yet already - add a development team and enable signing (this may require an AppleID to access to a development team).


## Enabling Windows support

Some of our packages have filepaths that violate some Windows path character limits. In order to correct this, you may need:

- Change the Windows [file path restriction](https://www.howtogeek.com/266621/how-to-make-windows-10-accept-file-paths-over-260-characters/)
- Remove restrictions via git config (you may need to run a prompt as administrator):

```terminal
git config --system.core.longpaths true
```

### Using HostedUI on Web

The Hosted UI configuration for the hostedUI environment in this application expects an app running on `localhost:4000`.

To support this, be sure to run the `run` or `test` commands with a specified port:

`flutter run --dart-define=AMPLIFY_CONFIG=hostedUI -d chrome --web-port=4000`

## Specifying an environment

Before specifying an environment, you will need to paste the appropriate configs (provided separately) into the corresponding files in `lib/envs/`. 

By default, both the integration tests and application will use the deviceTracking environment. Use the dart-define parameter to assign an `AMPLIFY_CONFIG` variable for either the tests or the application:

```terminal
flutter run --dart-define=AMPLIFY_CONFIG=hostedUI
```

## Authoring automated tests

This application has scaffolding for integration tests included. To write new tests, add test files to `/integration_test/` and enable their execution in `/integration_test/main.dart`. Samples are provided in this directory.
